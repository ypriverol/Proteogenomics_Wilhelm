
<!DOCTYPE html>
<html>
<head>
<style type="text/css">
.knitr .inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage .left {
  text-align: left;
}
.rimage .right {
  text-align: right;
}
.rimage .center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
  <script src="http://yihui.name/media/js/center-images.js"></script>
  <title>A Report Generated by knitr</title>
</head>
<body>

  <p>This report is automatically generated with the R
    package <a href="http://yihui.name/knitr"><strong>knitr</strong></a>
    (version <code class="knitr inline">1.10.5</code>)
    .</p>

<div class="chunk" id="auto-report"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(gdata)</span>
</pre></div>
<div class="message"><pre class="knitr r">## gdata: read.xls support for 'XLS' (Excel 97-2004) files ENABLED.
## 
## gdata: Unable to load perl libaries needed by read.xls()
## gdata: to support 'XLSX' (Excel 2007+) files.
## 
## gdata: Run the function 'installXLSXsupport()'
## gdata: to automatically download and install the perl
## gdata: libaries needed to support Excel XLS and XLSX formats.
## 
## Attaching package: 'gdata'
## 
## The following object is masked from 'package:stats':
## 
##     nobs
## 
## The following object is masked from 'package:utils':
## 
##     object.size
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(ggplot2)</span>
<span class="hl kwd">library</span><span class="hl std">(reshape)</span>
<span class="hl kwd">library</span><span class="hl std">(reshape2)</span>
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'reshape2'
## 
## The following objects are masked from 'package:reshape':
## 
##     colsplit, melt, recast
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">load</span><span class="hl std">(</span><span class="hl str">&quot;3_Mats.RData&quot;</span><span class="hl std">)</span>

<span class="hl std">genes</span> <span class="hl kwb">&lt;-</span> <span class="hl std">proteins</span>
<span class="hl kwd">table</span><span class="hl std">(values.av</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">sapply</span><span class="hl std">(genes,</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">p</span><span class="hl std">){</span>
  <span class="hl kwd">return</span><span class="hl std">(</span><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl opt">!</span><span class="hl kwd">is.na</span><span class="hl std">(mats</span><span class="hl opt">$</span><span class="hl std">prots[p,])</span> <span class="hl opt">&amp; !</span><span class="hl kwd">is.na</span><span class="hl std">(mats</span><span class="hl opt">$</span><span class="hl std">mRNA[p,])))</span>
<span class="hl std">}))</span>
</pre></div>
<div class="output"><pre class="knitr r">## 
##    0    1    2    3    4    5    6    7    8    9   10   11   12 
##  183  350  747  535  432  371  322  321  280  315  363  493 1392
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># ggplot(data.frame(Values=factor(values.av)), aes(x=Values)) + geom_histogram() + theme_bw(24)</span>

<span class="hl kwd">names</span><span class="hl std">(values.av)</span> <span class="hl kwb">&lt;-</span> <span class="hl std">genes</span>

<span class="hl kwd">str</span><span class="hl std">(aDat</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">data.frame</span><span class="hl std">(</span><span class="hl kwc">Values</span> <span class="hl std">= values.av[genes]))</span>
</pre></div>
<div class="output"><pre class="knitr r">## 'data.frame':	6104 obs. of  1 variable:
##  $ Values: int  2 12 5 12 7 12 2 7 9 12 ...
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">rownames</span><span class="hl std">(aDat)</span> <span class="hl kwb">&lt;-</span> <span class="hl std">genes</span>

<span class="hl kwd">set.seed</span><span class="hl std">(</span><span class="hl num">18828</span><span class="hl std">)</span>

<span class="hl com"># PREDICT PROTEINS FROM ALL OTHER GENES (Average after) -------------------------------------------------------------------</span>
<span class="hl kwd">library</span><span class="hl std">(doMC)</span>
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: foreach
## Loading required package: iterators
## Loading required package: parallel
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">registerDoMC</span><span class="hl std">(</span><span class="hl kwc">cores</span> <span class="hl std">=</span> <span class="hl num">11</span><span class="hl std">)</span>
<span class="hl std">gns.idces</span> <span class="hl kwb">&lt;-</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(proteins)</span>
<span class="hl std">randomVecs</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">foreach</span><span class="hl std">(</span><span class="hl kwc">p.idx</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(proteins))</span> <span class="hl opt">%dopar%</span> <span class="hl std">{</span>
  <span class="hl com"># make predictions per gene (for all genes)</span>
  <span class="hl std">proteinPredictionMatrix</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">sapply</span><span class="hl std">(</span><span class="hl kwd">sample</span><span class="hl std">(gns.idces[</span><span class="hl opt">-</span><span class="hl std">p.idx]),</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">g.idx</span><span class="hl std">){</span>
    <span class="hl com"># get ratio for this gene</span>
    <span class="hl std">ratio</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">median</span><span class="hl std">(mats</span><span class="hl opt">$</span><span class="hl std">prots[p.idx, ]</span><span class="hl opt">/</span><span class="hl std">mats</span><span class="hl opt">$</span><span class="hl std">mRNAs[g.idx, ],</span> <span class="hl kwc">na.rm</span><span class="hl std">=T)</span>
    <span class="hl com"># predict tissue for this gene</span>
    <span class="hl kwd">return</span><span class="hl std">(mats</span><span class="hl opt">$</span><span class="hl std">mRNAs[g.idx, ]</span> <span class="hl opt">*</span> <span class="hl std">ratio)</span>
  <span class="hl std">})</span>
  <span class="hl com"># get average protein prediction for this gene and put it into one big matrix</span>
  <span class="hl kwd">return</span><span class="hl std">(</span><span class="hl kwd">apply</span><span class="hl std">(proteinPredictionMatrix,</span> <span class="hl num">1</span><span class="hl std">, mean,</span> <span class="hl kwc">na.rm</span><span class="hl std">=T))</span>
<span class="hl std">}</span>

<span class="hl kwd">str</span><span class="hl std">(randomMat</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">do.call</span><span class="hl std">(rbind, randomVecs))</span>
</pre></div>
<div class="output"><pre class="knitr r">##  num [1:6104, 1:12] 9.54e-06 1.95e-05 1.69e-06 2.14e-04 1.37e-05 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr [1:12] &quot;uterus&quot; &quot;kidney&quot; &quot;testis&quot; &quot;pancreas&quot; ...
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">save</span><span class="hl std">(randomMat,</span> <span class="hl kwc">file</span><span class="hl std">=</span><span class="hl str">&quot;10_RandomMat.RData&quot;</span><span class="hl std">)</span>

<span class="hl kwd">plot</span><span class="hl std">(randomMat[</span><span class="hl num">2</span><span class="hl std">,], mats</span><span class="hl opt">$</span><span class="hl std">prots[</span><span class="hl num">2</span><span class="hl std">,])</span>
</pre></div>
</div><div class="rimage center"><img src="figure/10-RandomGenes-Rhtmlauto-report-1.png" title="plot of chunk auto-report" alt="plot of chunk auto-report" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># ORGANIZE THIS FOR COMPARISON --------------------------------------------</span>
<span class="hl std">mats2</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">list</span><span class="hl std">(</span>
  <span class="hl kwc">Original</span> <span class="hl std">= mats</span><span class="hl opt">$</span><span class="hl std">Ratio,</span>
  <span class="hl kwc">Random</span> <span class="hl std">= randomMat</span>
<span class="hl std">)</span>
<span class="hl kwa">for</span><span class="hl std">(matNam</span> <span class="hl kwa">in</span> <span class="hl kwd">names</span><span class="hl std">(mats2)){</span>
  <span class="hl kwd">rownames</span><span class="hl std">(mats2[[matNam]])</span> <span class="hl kwb">&lt;-</span> <span class="hl std">proteins</span>
  <span class="hl kwd">colnames</span><span class="hl std">(mats2[[matNam]])</span> <span class="hl kwb">&lt;-</span> <span class="hl std">tissues</span>
<span class="hl std">}</span>

<span class="hl com"># CORRELATION ACROSS PROTEINS PER TISSUE ----------------------------------</span>
<span class="hl std">corTissues</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">list</span><span class="hl std">()</span> <span class="hl com"># this is where the correlations are stored finally</span>
<span class="hl kwa">for</span><span class="hl std">(matNam</span> <span class="hl kwa">in</span> <span class="hl kwd">names</span><span class="hl std">(mats2)){</span>
  <span class="hl std">corTissues[[matNam]]</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">sapply</span><span class="hl std">(tissues,</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">t1</span><span class="hl std">){</span><span class="hl kwd">cor</span><span class="hl std">(mats</span><span class="hl opt">$</span><span class="hl std">prots[,t1], mats2[[matNam]][,t1],</span> <span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;spearman&quot;</span><span class="hl std">,</span> <span class="hl kwc">use</span><span class="hl std">=</span><span class="hl str">&quot;pairwise.complete.obs&quot;</span><span class="hl std">)})</span>
<span class="hl std">}</span>
<span class="hl com"># BOXPLOT</span>
<span class="hl std">matriXes</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Original&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Random&quot;</span><span class="hl std">)</span>
<span class="hl kwd">names</span><span class="hl std">(corTissues)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;Original&quot; &quot;Random&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sapply</span><span class="hl std">(corTissues, length)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Original   Random 
##       12       12
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">pDat</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">melt.list</span><span class="hl std">(corTissues[matriXes])</span>
<span class="hl std">pDat</span><span class="hl opt">$</span><span class="hl std">predictionMat</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">factor</span><span class="hl std">(pDat</span><span class="hl opt">$</span><span class="hl std">L1,</span> <span class="hl kwc">levels</span><span class="hl std">=</span><span class="hl kwd">names</span><span class="hl std">(corTissues))</span> <span class="hl com"># sorting of names</span>
<span class="hl kwd">ggplot</span><span class="hl std">(pDat,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=predictionMat,</span> <span class="hl kwc">y</span><span class="hl std">=value))</span> <span class="hl opt">+</span> <span class="hl kwd">theme_bw</span><span class="hl std">(</span><span class="hl num">24</span><span class="hl std">)</span> <span class="hl opt">+</span>
  <span class="hl kwd">xlab</span><span class="hl std">(</span><span class="hl str">&quot;Method&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">ylab</span><span class="hl std">(</span><span class="hl str">&quot;Correlation (R)&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
  <span class="hl kwd">theme</span><span class="hl std">(</span><span class="hl kwc">axis.text.x</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">angle</span> <span class="hl std">=</span> <span class="hl num">90</span><span class="hl std">,</span> <span class="hl kwc">hjust</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">))</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_boxplot</span><span class="hl std">(</span><span class="hl kwc">fill</span><span class="hl std">=</span><span class="hl str">&quot;lightgrey&quot;</span><span class="hl std">,</span> <span class="hl kwc">colour</span><span class="hl std">=</span><span class="hl str">&quot;grey&quot;</span><span class="hl std">,</span> <span class="hl kwc">outlier.colour</span> <span class="hl std">=</span> <span class="hl str">&quot;grey&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_jitter</span><span class="hl std">(</span><span class="hl kwc">position</span> <span class="hl std">=</span> <span class="hl kwd">position_jitter</span><span class="hl std">(</span><span class="hl kwc">width</span> <span class="hl std">=</span> <span class="hl num">.1</span><span class="hl std">))</span>
</pre></div>
</div><div class="rimage center"><img src="figure/10-RandomGenes-Rhtmlauto-report-2.png" title="plot of chunk auto-report" alt="plot of chunk auto-report" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">ggsave</span><span class="hl std">(</span><span class="hl kwd">paste0</span><span class="hl std">(</span><span class="hl str">&quot;10_Random_AcrossGenesPerTissue.pdf&quot;</span><span class="hl std">),</span> <span class="hl kwc">width</span><span class="hl std">=</span><span class="hl num">5</span><span class="hl std">,</span> <span class="hl kwc">height</span><span class="hl std">=</span><span class="hl num">5</span><span class="hl std">)</span>



<span class="hl com"># CORRELATING ACROSS TISSUES PER GENE  -------------------</span>
<span class="hl std">corGenes</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">list</span><span class="hl std">()</span>
<span class="hl kwa">for</span><span class="hl std">(matNam</span> <span class="hl kwa">in</span> <span class="hl kwd">names</span><span class="hl std">(mats2)){</span>
  <span class="hl std">corGenes[[matNam]]</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">sapply</span><span class="hl std">(proteins,</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">p1</span><span class="hl std">){</span><span class="hl kwd">cor</span><span class="hl std">(mats</span><span class="hl opt">$</span><span class="hl std">prots[p1,], mats2[[matNam]][p1,],</span> <span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;spearman&quot;</span><span class="hl std">,</span> <span class="hl kwc">use</span><span class="hl std">=</span><span class="hl str">&quot;pairwise.complete.obs&quot;</span><span class="hl std">)})</span>
<span class="hl std">}</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning in cor(mats$prots[p1, ], mats2[[matNam]][p1, ], method = &quot;spearman&quot;, : the
## standard deviation is zero
</pre></div>
<div class="warning"><pre class="knitr r">## Warning in cor(mats$prots[p1, ], mats2[[matNam]][p1, ], method = &quot;spearman&quot;, : the
## standard deviation is zero
</pre></div>
<div class="warning"><pre class="knitr r">## Warning in cor(mats$prots[p1, ], mats2[[matNam]][p1, ], method = &quot;spearman&quot;, : the
## standard deviation is zero
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># BOXPLOT</span>
<span class="hl std">matriXes</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;Original&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Random&quot;</span><span class="hl std">)</span>
<span class="hl kwd">names</span><span class="hl std">(corGenes)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;Original&quot; &quot;Random&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sapply</span><span class="hl std">(corGenes, length)</span>
</pre></div>
<div class="output"><pre class="knitr r">## Original   Random 
##     6104     6104
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">str</span><span class="hl std">(pDat</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">melt.list</span><span class="hl std">(corGenes[matriXes]))</span>
</pre></div>
<div class="output"><pre class="knitr r">## 'data.frame':	12208 obs. of  2 variables:
##  $ value: num  1 -0.0911 0.2 0.0876 -0.3214 ...
##  $ L1   : chr  &quot;Original&quot; &quot;Original&quot; &quot;Original&quot; &quot;Original&quot; ...
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">pDat</span><span class="hl opt">$</span><span class="hl std">predictionMat</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">factor</span><span class="hl std">(pDat</span><span class="hl opt">$</span><span class="hl std">L1,</span> <span class="hl kwc">levels</span><span class="hl std">=matriXes)</span> <span class="hl com"># sorting of names</span>
<span class="hl kwd">ggplot</span><span class="hl std">(pDat,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">=value,</span> <span class="hl kwc">colour</span><span class="hl std">=predictionMat,</span> <span class="hl kwc">group</span><span class="hl std">=predictionMat))</span> <span class="hl opt">+</span> <span class="hl kwd">theme_bw</span><span class="hl std">(</span><span class="hl num">24</span><span class="hl std">)</span> <span class="hl opt">+</span>
  <span class="hl kwd">xlab</span><span class="hl std">(</span><span class="hl str">&quot;Correlation (R)&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
<span class="hl com">#   theme(axis.text.x = element_text(angle = 90, hjust = 1)) + </span>
  <span class="hl kwd">geom_density</span><span class="hl std">(</span><span class="hl kwc">fill</span><span class="hl std">=</span><span class="hl num">NA</span><span class="hl std">,</span> <span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: Removed 861 rows containing non-finite values (stat_density).
</pre></div>
</div><div class="rimage center"><img src="figure/10-RandomGenes-Rhtmlauto-report-3.png" title="plot of chunk auto-report" alt="plot of chunk auto-report" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">ggsave</span><span class="hl std">(</span><span class="hl kwd">paste0</span><span class="hl std">(</span><span class="hl str">&quot;10_Random_AcrossTissuesPerGene.pdf&quot;</span><span class="hl std">),</span> <span class="hl kwc">width</span><span class="hl std">=</span><span class="hl num">5</span><span class="hl std">,</span> <span class="hl kwc">height</span><span class="hl std">=</span><span class="hl num">5</span><span class="hl std">)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: Removed 861 rows containing non-finite values (stat_density).
</pre></div>
</div></div>

  <p>The R session information (including the OS info, R version and all
    packages used):</p>

<div class="chunk" id="session-info"><div class="rcode"><div class="source"><pre class="knitr r">    <span class="hl kwd">sessionInfo</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## R version 3.1.2 (2014-10-31)
## Platform: x86_64-unknown-linux-gnu (64-bit)
## 
## locale:
##  [1] LC_CTYPE=en_CA.UTF-8       LC_NUMERIC=C               LC_TIME=en_CA.UTF-8       
##  [4] LC_COLLATE=en_CA.UTF-8     LC_MONETARY=en_CA.UTF-8    LC_MESSAGES=en_CA.UTF-8   
##  [7] LC_PAPER=en_CA.UTF-8       LC_NAME=C                  LC_ADDRESS=C              
## [10] LC_TELEPHONE=C             LC_MEASUREMENT=en_CA.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  base     
## 
## other attached packages:
## [1] doMC_1.3.3      iterators_1.0.8 foreach_1.4.3   reshape2_1.4.1  reshape_0.8.5  
## [6] ggplot2_2.0.0   gdata_2.17.0   
## 
## loaded via a namespace (and not attached):
##  [1] codetools_0.2-14 colorspace_1.2-6 compiler_3.1.2   digest_0.6.9     evaluate_0.7    
##  [6] formatR_1.2      grid_3.1.2       gtable_0.1.2     gtools_3.5.0     highr_0.5       
## [11] knitr_1.10.5     labeling_0.3     magrittr_1.5     methods_3.1.2    munsell_0.4.2   
## [16] plyr_1.8.3       Rcpp_0.12.0      scales_0.3.0     stringi_1.0-1    stringr_1.0.0   
## [21] tools_3.1.2
</pre></div>
<div class="source"><pre class="knitr r">    <span class="hl kwd">Sys.time</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;2016-01-26 12:10:06 PST&quot;
</pre></div>
</div></div>


</body>
</html>
